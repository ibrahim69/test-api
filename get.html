<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Github User</title>

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/jquery.dataTables.min.css">

    <script src="js/jquery.min.js"></script>

    <script src="js/bootstrap.min.js"></script>
    <script src="js/datatables.min.js"></script>
    <script src="js/jquery.dataTables.min.js"></script>
    <script src="js/dataTables.bootstrap4.min.js"></script>
</head>
<body>
    <div id="app">
        <div class="container">

            <h1>GitHub GET</h1>

            <div class="button">
                <button type="button" class="btn btn-success create">New</button>
                <button type="button" class="btn btn-danger edit">Edit</button>
            </div>

            <div class="new-item">
                <form action="" method="POST" class="form-post">
                    <fieldset>
                        <legend>Add New Data</legend>
                        <div id="nama-sayur-group" class="form-group row">
                            <label class="col-sm-2 col-form-label">Nama:</label>
                            <div class="col-sm-10">
                                <input type="text" class="nama-sayur form-control" name="namaSayur" placeholder="nama sayur ....." />
                            </div>
                        </div>
            
                        <div id="type-group" class="form-group row">
                            <label class="col-sm-2 col-form-label" for="">Type:</label>
                            <div class="col-sm-10">
                                <select name="typeSayur" id="type" class="type-sayur form-control">
                                    <option value="appetizer">Appetizer</option>
                                    <option value="main-course">Main Course</option>
                                    <option value="dessert">Dessert</option>
                                </select>
                            </div>
                        </div>
                        
                        <button type="submit" class="submit btn btn-light" name="submit">Add New</button>
                    
                    </fieldset>
                </form>
            </div>

            <table id="example" class="display" style="width: 100%;">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Name</th>
                        <th>Type</th>
                    </tr>
                </thead>
                <tfoot>
                    <tr>
                        <th>Id</th>
                        <th>Name</th>
                        <th>Type</th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            
            var btnSubmit = document.getElementsByClassName('submit');

            getDataFormAPI();

            
            // process the form
            $('.submit').click(function() {
                var formData = {
                    'name' : $('.nama_sayur').val(),
                    'type' : $('.type_sayur').val()
                };

                // process the form
                $.ajax({
                    type : 'POST', // define the type of HTTP verb we want to use (POST for our form)
                    url: 'http://api.wibs.sch.id/v2/meal/post/datatable.food-category.store', // the url where we want to POST
                    data : formData, // our data object,
                    dataType : 'json', // what type of data do we expect back from the server
                    headers: {
                        'Application-Token' : 'geSzgVahOlowulcgHEtQmu9Ybofk1lRnPFd3V5atSEu1SD1dt2'
                    }
                    // encode : true
                })
                    // using the promise callback
                    .done(function(data) {
                        // log data to the console so we can see
                        // $('.form-post .submit').on('click', function() {
                        //     $('.new-item').toggleClass('display-on');
                        //     dataTable.row.add(formData).draw(false);
                        // })

                        console.log(data)

                        var rowNode = dataTable.row.add(data).draw().node()
                    })

                    .fail(function(data) {
                        // show any errors
                        // best to remove for production
                        console.log(data);
                    })

                    
                // stop the form from submitting the normal way and refreshing the page
                event.preventDefault();
            })
        })
    </script>


    <script>
        // Declaration
        var dataTable = $('#example');

        // Function
        function getDataFormAPI() {
            dataTable.DataTable({
                dom: 'Bfrtip',
                processing: true,
                serverSide: true,
                ajax: {
                    'url' : 'http://api.wibs.sch.id/v2/meal/post/datatable.food-category',
                    'type' : 'POST',
                    'contentType' : "application/json",
                    'dataType' : 'json',
                    headers: {
                        'Application-Token' : 'geSzgVahOlowulcgHEtQmu9Ybofk1lRnPFd3V5atSEu1SD1dt2'
                    },
                },
                columns: [
                    {
                        data: 'id'
                    },
                    {
                        data: 'name'
                    },
                    {
                        data: 'type'
                    }
                ],
                select: true
            });
        }

    </script>

</body>
</html>